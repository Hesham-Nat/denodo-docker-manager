<!DOCTYPE html>
<html class="h-full">
<head>
  <meta charset="UTF-8" />
  <title>Running Containers</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col min-h-screen bg-gradient-to-br from-gray-100 via-gray-200 to-white text-gray-900">
  {% include "partials/navbar.html" %}

  <div class="flex-grow px-6 py-10 w-full">
        <!-- ğŸ” Tabs -->
    <div class="flex space-x-4 mb-6">
      <a href="/containers"
        class="px-4 py-2 rounded font-semibold shadow
                {% if request.url.path == '/containers' %}bg-blue-600 text-white{% else %}bg-white text-gray-800 border border-gray-300{% endif %}">
        ğŸš€ Standalone Containers
      </a>
      <a href="/containers/compose-groups"
        class="px-4 py-2 rounded font-semibold shadow
                {% if request.url.path == '/containers/compose-groups' %}bg-purple-600 text-white{% else %}bg-white text-gray-800 border border-gray-300{% endif %}">
        ğŸ“¦ Docker Compose Groups
      </a>
      <a href="/containers/list-all"
        class="px-4 py-2 rounded font-semibold shadow
                {% if request.url.path == '/containers/list-all' %}bg-purple-600 text-white{% else %}bg-white text-gray-800 border border-gray-300{% endif %}">
        ğŸ“ƒ List All Containers
      </a>
    </div>

    <!-- âœ… Flash Message -->
    {% if request.query_params.get('success') %}
      <div class="mb-4 px-6 py-3 bg-green-100 text-green-800 border border-green-300 rounded-lg shadow-md">
        âœ… {{ request.query_params.get('success') }}
      </div>
    {% elif request.query_params.get('error') %}
      <div class="mb-4 px-6 py-3 bg-red-100 text-red-800 border border-red-300 rounded-lg shadow-md">
        âŒ {{ request.query_params.get('error') }}
      </div>
    {% endif %}

    <!-- ğŸ§  Page Title -->
    <h1 class="text-4xl font-extrabold mb-8 text-gray-800">ğŸš€ Running Containers</h1>

    <!-- ğŸ”„ Import Config Upload -->
    <div class="mb-10 bg-white border border-gray-300 p-6 rounded-2xl shadow-md">
      <form action="/containers/import-config" method="post" enctype="multipart/form-data" class="flex flex-wrap items-center gap-4 w-full">
        <label for="json_file" class="font-semibold text-lg text-gray-700">ğŸ“¥ Import Config:</label>
        <input type="file" name="json_file" id="json_file" accept=".json"
               class="flex-1 border border-gray-400 rounded px-3 py-2 w-full max-w-xl
                      file:mr-4 file:py-2 file:px-4 file:rounded file:border-0
                      file:bg-blue-600 file:text-white hover:file:bg-blue-700" required>
        <button type="submit"
                class="px-6 py-2 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700 shadow">
          Upload
        </button>
      </form>
    </div>

    {% if containers %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 ">
      {% for c in containers %}
      <div class="bg-white border border-gray-300 rounded-2xl shadow-md p-6 hover:shadow-lg transition">
        <h2 class="text-xl font-bold text-gray-800 mb-4">{{ c.name }}</h2>

        <div class="flex flex-col sm:flex-row sm:justify-between gap-4">
          <!-- Metadata -->
          <div class="text-sm text-gray-700 space-y-1 flex-1">
            <p><strong>ID:</strong> <span class="text-gray-900">{{ c.id }}</span></p>
            <p><strong>Image:</strong> {{ c.image.split(':')[-1] }}</p>
            <p><strong>Group:</strong> {{ c.image.split('/')[-1].split(':')[0] }}</p>
            <p>
              <strong>Status:</strong>
              {% if 'running' in c.status %}
                <span class="inline-flex items-center px-2 py-0.5 text-sm font-medium bg-green-100 text-green-800 rounded-full">ğŸŸ¢ Running</span>
              {% else %}
                <span class="inline-flex items-center px-2 py-0.5 text-sm font-medium bg-red-100 text-red-800 rounded-full">ğŸ”´ Stopped</span>
              {% endif %}
            </p>
          </div>

          <!-- Action Buttons -->
          <div class="bg-gray-50 border border-gray-200 rounded-xl p-3 flex flex-col gap-0 w-full sm:w-64">
            {% if 'running' in c.status %}
            <form method="post" action="/containers/{{ c.id }}/stop">
              <button type="submit" class="w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 rounded-md">
                â¸ Stop
              </button>
            </form>
            {% else %}
            <form method="post" action="/containers/{{ c.id }}/start">
              <button type="submit" class="w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 rounded-md">
                â–¶ Start
              </button>
            </form>
            {% endif %}

            <form method="post" action="/containers/{{ c.id }}/delete" onsubmit="return confirm('Are you sure you want to delete this container?')">
              <button type="submit" class="w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 rounded-md">
                ğŸ—‘ Delete
              </button>
            </form>

            <form action="/containers/{{ c.id }}/rebuild" method="get">
              <button class="w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 rounded-md">
                ğŸ”„ Rebuild
              </button>
            </form>

            <form action="/containers/{{ c.id }}/logs" method="get">
              <button class="w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 rounded-md">
                ğŸ“œ Logs
              </button>
            </form>

            <form action="/containers/{{ c.id }}/terminal" method="get">
              <button class="w-full text-left px-4 py-2 text-sm hover:bg-yellow-100 rounded-md">
                ğŸ–¥ï¸ Terminal
              </button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
      <p class="text-center text-gray-500 mt-12 text-lg">No containers found.</p>
    {% endif %}
  </div>

   <!-- Spinner Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-60 flex flex-col items-center justify-center z-50 hidden">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-yellow-400 border-solid mb-6"></div>
    <span id="loading-message" class="text-white text-lg font-semibold animate-pulse">Just a sec... ğŸ˜Š</span>
  </div>
    
<script>
  const loadingOverlay = document.getElementById("loading-overlay");
  const loadingMsg = document.getElementById("loading-message");

  const funnyMessages = [
    "Waking up the containers...",
    "Feeding the Docker daemon...",
    "Pushing bytes through the tubes...",
    "Assembling whales ğŸ³...",
    "Downloading the Internet (almost)...",
    "Negotiating with the GCR gods...",
    "Compiling caffeine...",
    "Whispering to Linux subsystems...",
    "Placing pixels just right...",
    "Summoning a smiley soon..."
  ];

  let intervalId;

  // Show a random message every 1.6 seconds
  function startFunnyMessages() {
    intervalId = setInterval(() => {
      const randomMsg = funnyMessages[Math.floor(Math.random() * funnyMessages.length)];
      loadingMsg.textContent = randomMsg;
    }, 1600);
  }

  // End with a smiley
  function showSmiley() {
    clearInterval(intervalId);
    loadingMsg.textContent = "Wait... ğŸ˜€";
  }

  // Hook into all form submissions
  document.querySelectorAll("form").forEach(form => {
    form.addEventListener("submit", () => {
      loadingOverlay.classList.remove("hidden");
      startFunnyMessages();
      // Optional: end with smile after 6s if the page hasnâ€™t redirected yet
      setTimeout(showSmiley, 9000);
    });
  });
</script>
<script>
  // Prevent spinner from staying visible after back/forward navigation
  window.addEventListener("pageshow", function (event) {
    // This ensures it runs even when bfcache is used
    const overlay = document.getElementById("loading-overlay");
    if (overlay) {
      overlay.classList.add("hidden");
    }
  });
</script>
    {% include "partials/footer.html" %}
</body>
</html>
