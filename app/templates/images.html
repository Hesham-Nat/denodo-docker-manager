<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <title>Docker Images</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom scrollbar for the table */
    .scrollbar-thin::-webkit-scrollbar {
      height: 8px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(100, 116, 139, 0.5);
      border-radius: 10px;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen bg-gradient-to-br from-gray-100 via-gray-200 to-white text-gray-900">
  {% include "partials/navbar.html" %}

  <main class="space-y-12 flex-grow px-6 py-10 w-full">
    <!-- Page Title -->
    <h1 class="text-5xl font-extrabold text-gray-900 flex items-center gap-3">
      <span>🐳</span> Docker Images
    </h1>

    <!-- Flash Messages -->
    {% if request.query_params.get('success') %}
      <div class="flex items-center gap-3 px-6 py-3 bg-green-100 text-green-900 border border-green-300 rounded-lg shadow-md text-lg font-semibold max-w-xl">
        ✅ {{ request.query_params.get('success') }}
      </div>
    {% elif request.query_params.get('error') %}
      <div class="flex items-center gap-3 px-6 py-3 bg-red-100 text-red-900 border border-red-300 rounded-lg shadow-md text-lg font-semibold max-w-xl">
        ❌ {{ request.query_params.get('error') }}
      </div>
    {% endif %}

    <!-- Forms side by side on md+ -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-10">
      <!-- Import Image -->
      <div class="bg-white p-8 rounded-3xl border border-gray-300 shadow-lg hover:shadow-xl transition-shadow duration-300">
        <h2 class="text-3xl font-semibold mb-6 flex items-center gap-2 text-gray-900">
          📥 Import Image from Local File
        </h2>
        <form action="/images/import" method="post" enctype="multipart/form-data" class="flex flex-col sm:flex-row items-center gap-6">
          <input
            type="file" name="imageFile" accept=".tar,.tar.gz,.tgz"
            class="w-full sm:max-w-md px-4 py-3 text-base border border-gray-400 rounded-xl bg-gray-50 shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-gray-400"
            required
          />
          <button type="submit"
                  class="w-full sm:w-auto px-8 py-3 text-gray-700 font-semibold rounded-xl border border-gray-400 bg-gray-100 hover:bg-gray-200 transition">
            Upload Image
          </button>
        </form>
      </div>

      <!-- Pull Image -->
      <div class="bg-white p-8 rounded-3xl border border-gray-300 shadow-lg hover:shadow-xl transition-shadow duration-300">
        <h2 class="text-3xl font-semibold mb-6 flex items-center gap-2 text-gray-900">
          🌐 Pull Image from Registry
        </h2>
        <form action="/images/pull" method="post" class="flex flex-col sm:flex-row items-center gap-6">
          <input
            type="text" name="image_name"
            placeholder="e.g. mysql:8, postgres:15, gcr.io/project/image:tag"
            class="w-full sm:max-w-md px-4 py-3 text-base border border-gray-400 rounded-xl bg-gray-50 shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-gray-400"
            required
          />
          <button type="submit"
                  class="w-full sm:w-auto px-8 py-3 text-gray-700 font-semibold rounded-xl border border-gray-400 bg-gray-100 hover:bg-gray-200 transition">
            Pull Image
          </button>
        </form>
      </div>
    </section>

    <!-- Image List Table -->
    <section class="bg-white p-8 rounded-3xl border border-gray-300 shadow-lg">
      <h2 class="text-3xl font-semibold mb-8 text-gray-900 flex items-center gap-2">
        🗂️ Available Docker Images
      </h2>

      {% if images %}
      <div class="overflow-x-auto rounded-lg border border-gray-200 scrollbar-thin">
        <table class="min-w-full divide-y divide-gray-300 text-base">
          <thead class="bg-gray-100 text-gray-700 font-semibold uppercase tracking-wide">
            <tr>
              <th class="px-8 py-4 text-left">Tag</th>
              <th class="px-8 py-4 text-center">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for image in images %}
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-8 py-5 text-gray-800 font-medium">{{ image }}</td>
              <td class="px-8 py-5 text-center">
                <form method="post" action="/images/delete"  onsubmit="return confirm('Delete image: {{ image }}?')">
                  <input type="hidden" name="image" value="{{ image }}">
                  <button type="submit"
                          class="px-6 py-2 text-gray-700 font-semibold rounded-xl border border-gray-400 bg-gray-100 hover:bg-gray-200 transition">
                    🗑 Delete
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-center text-gray-500 text-xl mt-12 font-semibold">No Docker images found.</p>
      {% endif %}
    </section>
  </main>
   <!-- Spinner Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-60 flex flex-col items-center justify-center z-50 hidden">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-yellow-400 border-solid mb-6"></div>
    <span id="loading-message" class="text-white text-lg font-semibold animate-pulse">Just a sec... 😊</span>
  </div>
    
<script>
  const loadingOverlay = document.getElementById("loading-overlay");
  const loadingMsg = document.getElementById("loading-message");

  const funnyMessages = [
    "Waking up the containers...",
    "Feeding the Docker daemon...",
    "Pushing bytes through the tubes...",
    "Assembling whales 🐳...",
    "Downloading the Internet (almost)...",
    "Negotiating with the GCR gods...",
    "Compiling caffeine...",
    "Whispering to Linux subsystems...",
    "Placing pixels just right...",
    "Summoning a smiley soon..."
  ];

  let intervalId;

  // Show a random message every 1.6 seconds
  function startFunnyMessages() {
    intervalId = setInterval(() => {
      const randomMsg = funnyMessages[Math.floor(Math.random() * funnyMessages.length)];
      loadingMsg.textContent = randomMsg;
    }, 1600);
  }

  // End with a smiley
  function showSmiley() {
    clearInterval(intervalId);
    loadingMsg.textContent = "Wait... 😀";
  }

  // Hook into all form submissions
  document.querySelectorAll("form").forEach(form => {
    form.addEventListener("submit", () => {
      loadingOverlay.classList.remove("hidden");
      startFunnyMessages();
      // Optional: end with smile after 6s if the page hasn’t redirected yet
      setTimeout(showSmiley, 9000);
    });
  });
</script>
<script>
  // Prevent spinner from staying visible after back/forward navigation
  window.addEventListener("pageshow", function (event) {
    // This ensures it runs even when bfcache is used
    const overlay = document.getElementById("loading-overlay");
    if (overlay) {
      overlay.classList.add("hidden");
    }
  });
</script>
    {% include "partials/footer.html" %}
</body>
</html>
